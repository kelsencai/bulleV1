<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Aè‚¡ç¡¬çº¦æŸç›‘æ§ 7.0 - è®¸å“²é€»è¾‘ç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'PingFang SC', system-ui, sans-serif; background: #f0f2f5; padding: 20px; color: #1e293b; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.1); }
        h1 { color: #b91c1c; text-align: center; font-size: 26px; margin-bottom: 5px; }
        
        /* æ ¸å¿ƒä¾æ®å±•ç¤ºåŒº */
        .logic-board { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px; background: #f8fafc; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; }
        .logic-card { padding: 15px; background: white; border-radius: 8px; border-top: 4px solid #b91c1c; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .logic-card h4 { margin: 0 0 10px 0; color: #b91c1c; font-size: 15px; }
        .logic-card p { font-size: 12px; color: #64748b; line-height: 1.5; margin: 0; }

        .grid { display: grid; grid-template-columns: 360px 1fr; gap: 25px; }
        .panel { border: 1px solid #e2e8f0; padding: 20px; border-radius: 12px; }
        .panel h3 { margin-top: 0; font-size: 17px; margin-bottom: 15px; color: #0f172a; }

        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 13px; }
        input { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #cbd5e1; border-radius: 6px; }
        
        .btn-group { display: flex; flex-direction: column; gap: 8px; }
        .btn { padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; text-align: center; transition: 0.2s; }
        .btn-save { background: #059669; color: white; }
        .btn-view { background: #2563eb; color: white; }
        .btn-clear { background: #94a3b8; color: white; font-size: 12px; margin-top: 10px; }

        .alarm-zone { text-align: center; padding: 20px; border-radius: 10px; font-weight: bold; font-size: 18px; min-height: 80px; display: flex; align-items: center; justify-content: center; border: 2px solid transparent; margin-bottom: 15px; }
        .status-ok { background: #f0fdf4; color: #166534; border-color: #bbf7d0; }
        .status-danger { background: #fff1f2; color: #9f1239; border-color: #fecdd3; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }
        
        .links { margin-bottom: 20px; display: flex; justify-content: flex-end; gap: 15px; font-size: 13px; }
        .links a { color: #2563eb; text-decoration: none; font-weight: 600; }

        #displayArea { display: none; margin-top: 25px; border-top: 2px dashed #e2e8f0; padding-top: 25px; }
        .chart-container { height: 350px; margin-bottom: 25px; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        th, td { padding: 10px; border: 1px solid #e2e8f0; text-align: center; }
        th { background: #f8fafc; }
        .row-warn { color: #b91c1c; font-weight: bold; background: #fff1f2; }
    </style>
</head>
<body>

<div class="container">
    <h1>Aè‚¡æ³¡æ²«â€œå¤–éƒ¨ç¡¬çº¦æŸâ€ç›‘æ§ç³»ç»Ÿ 7.0</h1>
    <p style="text-align:center; font-size: 13px; color: #64748b; margin-bottom: 20px;">â€”â€” åŸºäºè®¸å“²ã€Šå¤–éƒ¨ç¡¬çº¦æŸæ˜¯å”¯ä¸€èƒ½è®©äººå†·é™ä¸‹æ¥çš„ä¸œè¥¿ã€‹åˆ†ææ¨¡å‹ â€”â€”</p>

    <div class="logic-board">
        <div class="logic-card">
            <h4>ä¾æ®ä¸€ï¼šæµåŠ¨æ€§åœ°å¿ƒå¼•åŠ›</h4>
            <p>è§‚å¯Ÿ 1M Shibor åˆ©ç‡ã€‚å½“ä¸Šæ¶¨éœ€è¦æ¶ˆè€—æ›´å¤šæ æ†æ—¶ï¼Œèµ„é‡‘ä»·æ ¼ä¼šé£™å‡ã€‚<b>çªç ´ 1.6%</b> å³æ„å‘³ç€è¿›å…¥å¼ºåˆ¶å†·é™æœŸã€‚</p>
        </div>
        <div class="logic-card">
            <h4>ä¾æ®äºŒï¼šæ æ†å­å¼¹æé™</h4>
            <p>è§‚å¯Ÿä¸¤èä½™é¢ã€‚è‹¥<b>æŒ‡æ•°åˆ›æ–°é«˜è€Œä¸¤èèç¼©</b>ï¼Œè¯´æ˜â€œæ¥åŠ›æ£’â€ä¼ ä¸åŠ¨äº†ï¼Œå…ˆå…¥è€…æ­£åœ¨æ’¤ç¦»ï¼Œåå…¥è€…èµ„é‡‘æ¯ç«­ã€‚</p>
        </div>
        <div class="logic-card">
            <h4>ä¾æ®ä¸‰ï¼šéç†æ€§æµªæ¼«åº¦</h4>
            <p>å¤–éƒ¨çº¦æŸèµ·æ•ˆçš„èƒŒæ™¯ã€‚å½“å…¨å¸‚åœºå¤„äºæåº¦è´ªå©ªæ—¶ï¼Œåˆ©ç‡å¾®å‡å³å¯è§¦å‘é›ªå´©ï¼ˆéœ€é…åˆå³ä¸Šè§’æƒ…ç»ªé“¾æ¥æŸ¥çœ‹ï¼‰ã€‚</p>
        </div>
    </div>

    <div class="links">
        <a href="http://www.chinamoney.com.cn/chinese/bkshibor/" target="_blank">ğŸ¦ æŸ¥åˆ©ç‡</a>
        <a href="https://data.eastmoney.com/rzrq/total.html" target="_blank">ğŸ“‰ æŸ¥ä¸¤è</a>
        <a href="https://app.jiucaishuo.com/pagesE/tool/fear_greed" target="_blank">ğŸ® æŸ¥æƒ…ç»ª</a>
    </div>

    <div class="grid">
        <div class="panel">
            <h3>å®¢è§‚æ•°æ®å½•å…¥</h3>
            <label>è§‚æµ‹æ—¥æœŸ</label>
            <input type="date" id="dateInput">
            <label>ä¸Šè¯æŒ‡æ•°æ”¶ç›˜ä½</label>
            <input type="number" id="indexInput" placeholder="è¯·è¾“å…¥ç‚¹ä½">
            <label>1M Shibor åˆ©ç‡ (%)</label>
            <input type="number" step="0.001" id="shiborInput" placeholder="æ ¸å¿ƒåˆ¤å®šä½">
            <label>ä¸¤èä½™é¢ (äº¿å…ƒ)</label>
            <input type="number" id="marginInput" placeholder="æ æ†æ€»è§„æ¨¡">
            
            <div class="btn-group">
                <button class="btn btn-save" onclick="handleLogic()">å­˜å…¥å¹¶è¿›è¡Œé€»è¾‘åˆ†æ</button>
                <button class="btn btn-view" onclick="toggleHistory()">å±•å¼€/æ”¶èµ· å†å²è½¨è¿¹å›¾</button>
                <button class="btn btn-clear" onclick="clearData()">æ¸…ç©ºæ•°æ®åº“</button>
            </div>
        </div>

        <div class="panel">
            <h3>è®¸å¤§æ¨¡å‹åˆ†æç»“è®º</h3>
            <div id="alarmBox" class="alarm-zone status-ok">
                å¾…æ£€æµ‹ï¼šç³»ç»Ÿå°†æ ¹æ®ç‰©ç†ä¸Šé™ç»™å‡ºå»ºè®®ã€‚
            </div>
            <div id="reportArea" style="padding: 15px; background: #fffbeb; border-radius: 8px; font-size: 13px; border: 1px solid #fef3c7; line-height: 1.6;">
                <strong>åˆ¤å®šæ‘˜è¦ï¼š</strong><br>
                è¾“å…¥æ•°æ®åï¼Œç³»ç»Ÿå°†ä»æµåŠ¨æ€§ä¸æ æ†èƒŒç¦»è§’åº¦è¿›è¡Œå›æµ‹ã€‚
            </div>
        </div>
    </div>

    <div id="displayArea">
        <div class="chart-container">
            <canvas id="mainChart"></canvas>
        </div>
        <h3>å†å²å†³ç­–è½¨è¿¹</h3>
        <table id="historyTable">
            <thead>
                <tr>
                    <th>æ—¥æœŸ</th>
                    <th>æŒ‡æ•°</th>
                    <th>åˆ©ç‡(%)</th>
                    <th>ä¸¤è(äº¿)</th>
                    <th>å†³ç­–ç»“æœ</th>
                    <th>é€»è¾‘ä¾æ®</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script>
    let stockData = JSON.parse(localStorage.getItem('stock_monitor_v7')) || [];
    document.getElementById('dateInput').valueAsDate = new Date();

    function handleLogic() {
        const date = document.getElementById('dateInput').value;
        const index = parseFloat(document.getElementById('indexInput').value);
        const shibor = parseFloat(document.getElementById('shiborInput').value);
        const margin = parseFloat(document.getElementById('marginInput').value);

        if(!date || isNaN(index) || isNaN(shibor) || isNaN(margin)) {
            alert("è¯·å®Œæ•´å¡«å†™æ‰€æœ‰å®¢è§‚å‚æ•°ï¼"); return;
        }

        const currentEntry = { date, index, shibor, margin };
        
        // æ‰§è¡Œåˆ†æå¼•æ“
        const analysis = runEngine(currentEntry);
        currentEntry.decision = analysis.decision;
        currentEntry.reason = analysis.reason;

        stockData.push(currentEntry);
        stockData.sort((a,b) => new Date(a.date) - new Date(b.date));
        localStorage.setItem('stock_monitor_v7', JSON.stringify(stockData));
        
        // æ›´æ–° UI
        document.getElementById('alarmBox').className = "alarm-zone " + (analysis.level > 0 ? "status-danger" : "status-ok");
        document.getElementById('alarmBox').innerHTML = analysis.decision;
        document.getElementById('reportArea').innerHTML = "<strong>åˆ¤å®šæ‘˜è¦ï¼š</strong><br>" + analysis.reason.replace(/\|/g, '<br>');
        
        renderTable();
        if(document.getElementById('displayArea').style.display === 'block') renderChart();
    }

    function runEngine(curr) {
        let level = 0;
        let reasons = [];
        
        // é€»è¾‘1ï¼š1.6% ç»å¯¹ç¡¬çº¦æŸ
        if (curr.shibor >= 1.6) {
            level = 2;
            reasons.push("ğŸš¨ Shibor 1.6%ï¼šé’±çš„ä»·æ ¼å·²åˆ°ç‰©ç†ä¸Šé™ï¼Œåœ°å¿ƒå¼•åŠ›æ— æ³•è¿èƒŒã€‚");
        }

        // é€»è¾‘2ï¼šèƒŒç¦»å›æµ‹
        if (stockData.length > 0) {
            const last = stockData[stockData.length - 1];
            if (curr.index > last.index && curr.margin < last.margin) {
                level = 2;
                reasons.push("ğŸ“‰ ä¸¤èèƒŒç¦»ï¼šæŒ‡æ•°ä¸Šæ¶¨ä½†æ æ†å‡å°‘ï¼Œè¯´æ˜å…ˆå…¥è€…åœ¨åŠ é€Ÿå…‘ç°ã€‚");
            }
            if (curr.index > last.index && curr.shibor > last.shibor) {
                level = Math.max(level, 1);
                reasons.push("âš ï¸ åˆ©ç‡ä¸Šè¡Œï¼šç»´æŒæŒ‡æ•°çš„æˆæœ¬åœ¨å¢åŠ ï¼Œæ—æ°ç»“æ„è„†å¼±ã€‚");
            }
        }

        return {
            level: level,
            decision: level >= 2 ? "ã€æ¸…ç›˜ä¿¡å·ã€‘ç¡¬çº¦æŸå·²ç”Ÿæ•ˆ" : (level === 1 ? "ã€è­¦æŠ¥ã€‘åœ°å¿ƒå¼•åŠ›å¢å¼º" : "ã€æŒä»“ã€‘ç¯å¢ƒå°šå¯æ”¯æ’‘"),
            reason: reasons.length > 0 ? reasons.join(" | ") : "æ•°æ®å¤„äºå¥åº·åšå¼ˆåŒºé—´ã€‚"
        };
    }

    function toggleHistory() {
        const area = document.getElementById('displayArea');
        area.style.display = (area.style.display === 'none' || area.style.display === '') ? 'block' : 'none';
        if(area.style.display === 'block') { renderChart(); renderTable(); }
    }

    function renderTable() {
        const tbody = document.querySelector('#historyTable tbody');
        tbody.innerHTML = '';
        stockData.slice().reverse().forEach(d => {
            tbody.innerHTML += `<tr class="${d.decision.includes('æ¸…ç›˜') ? 'row-warn' : ''}">
                <td>${d.date}</td><td>${d.index}</td><td>${d.shibor}%</td><td>${d.margin}</td>
                <td>${d.decision}</td><td style="text-align:left">${d.reason}</td>
            </tr>`;
        });
    }

    let myChart;
    function renderChart() {
        const ctx = document.getElementById('mainChart').getContext('2d');
        if (myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: stockData.map(d => d.date),
                datasets: [
                    { label: 'æŒ‡æ•°', data: stockData.map(d => d.index), borderColor: '#b91c1c', yAxisID: 'y' },
                    { label: 'åˆ©ç‡%', data: stockData.map(d => d.shibor), borderColor: '#2563eb', yAxisID: 'y1' }
                ]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });
    }

    function clearData() {
        if(confirm("ç¡®å®šæ°¸ä¹…æ¸…ç©ºæ‰€æœ‰å›æµ‹è½¨è¿¹ï¼Ÿ")) {
            stockData = []; localStorage.removeItem('stock_monitor_v7'); location.reload();
        }
    }
</script>
</body>
</html>